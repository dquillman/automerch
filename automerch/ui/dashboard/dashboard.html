<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dashboard - AutoMerch Lite</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: #f5f5f5;
            padding: 20px;
            transition: background 0.3s ease;
        }
        body.dark-mode { background: #1a1a1a; color: #e0e0e0; }
        .container { max-width: 1400px; margin: 0 auto; }
        .nav { background: #2d2d2d; padding: 16px 24px; margin-bottom: 24px; border-radius: 8px; display: flex; align-items: center; justify-content: space-between; flex-wrap: wrap; gap: 16px; }
        .nav a { color: #ccc; text-decoration: none; padding: 8px 12px; border-radius: 4px; transition: background 0.2s; }
        .nav a:hover { background: #3d3d3d; }
        .nav-title { color: #fff; font-size: 20px; font-weight: 600; }
        .stats-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 20px; margin-bottom: 30px; }
        .stat-card { background: white; padding: 24px; border-radius: 8px; box-shadow: 0 2px 4px rgba(0,0,0,0.1); transition: all 0.3s ease; }
        body.dark-mode .stat-card { background: #2d2d2d; box-shadow: 0 2px 8px rgba(0,0,0,0.3); }
        .stat-label { color: #6c757d; font-size: 14px; margin-bottom: 8px; text-transform: uppercase; }
        body.dark-mode .stat-label { color: #999; }
        .stat-value { font-size: 32px; font-weight: 600; color: #333; }
        body.dark-mode .stat-value { color: #e0e0e0; }
        .quick-actions { display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 16px; margin-bottom: 30px; }
        .action-btn { background: #007bff; color: white; padding: 16px 24px; border: none; border-radius: 8px; text-decoration: none; display: block; text-align: center; font-weight: 500; transition: all 0.2s; }
        .action-btn:hover { background: #0056b3; transform: translateY(-2px); }
        body.dark-mode .action-btn { background: #4d9fff; }
        body.dark-mode .action-btn:hover { background: #3a7fcc; }
        .recent-activity { background: white; padding: 24px; border-radius: 8px; box-shadow: 0 2px 4px rgba(0,0,0,0.1); }
        body.dark-mode .recent-activity { background: #2d2d2d; }
        .activity-item { padding: 12px 0; border-bottom: 1px solid #eee; }
        body.dark-mode .activity-item { border-bottom-color: #444; }
        .activity-item:last-child { border-bottom: none; }
    </style>
</head>
<body>
    <div class="container">
        <nav class="nav">
            <div style="display: flex; align-items: center; gap: 24px;">
                <a href="/" class="nav-title">üöÄ AutoMerch Lite</a>
                <a href="/" style="background: #007bff; color: white; padding: 8px 16px; border-radius: 4px; text-decoration: none; font-weight: 500;">üè† Home</a>
                <a href="/workflow">Workflow</a>
                <a href="/research">Research</a>
                <a href="/products/create">Products</a>
                <a href="/drafts">Drafts</a>
                <a href="/analytics">Analytics</a>
                <a href="/settings">‚öôÔ∏è Settings</a>
            </div>
            <div style="display: flex; align-items: center; gap: 16px;">
                <span style="color: #999; font-size: 12px; opacity: 0.7;">v<span id="app-version">-</span></span>
                <button onclick="toggleDarkMode()" id="dark-toggle" style="background: #495057; color: #fff; border: none; padding: 8px 16px; border-radius: 4px; cursor: pointer;">üåô Dark</button>
            </div>
        </nav>

        <h1 style="margin-bottom: 24px; color: #333; transition: color 0.3s;" class="dark-text">Dashboard</h1>

        <div class="stats-grid">
            <div class="stat-card">
                <div class="stat-label">Total Drafts</div>
                <div class="stat-value" id="stat-drafts">-</div>
            </div>
            <div class="stat-card">
                <div class="stat-label">Active Listings</div>
                <div class="stat-value" id="stat-active">-</div>
            </div>
            <div class="stat-card">
                <div class="stat-label">Products Created</div>
                <div class="stat-value" id="stat-products">-</div>
            </div>
            <div class="stat-card">
                <div class="stat-label">Research Queries</div>
                <div class="stat-value" id="stat-research">-</div>
            </div>
        </div>

        <div class="quick-actions">
            <a href="/research" class="action-btn">üîç Research Products</a>
            <a href="/products/create" class="action-btn">üé® Create Product</a>
            <a href="/products/printful" class="action-btn">üñ®Ô∏è Printful Products</a>
            <a href="/drafts" class="action-btn">üìã View Drafts</a>
            <a href="/workflow" class="action-btn">üöÄ View Workflow</a>
        </div>

        <div class="recent-activity">
            <h2 style="margin-bottom: 16px; color: #333; transition: color 0.3s;" class="dark-text">Recent Activity</h2>
            <div id="activity-list">Loading...</div>
        </div>
    </div>

    <script>
        function toggleDarkMode() {
            document.body.classList.toggle('dark-mode');
            const saved = document.body.classList.contains('dark-mode') ? 'enabled' : 'disabled';
            localStorage.setItem('darkMode', saved);
            document.getElementById('dark-toggle').textContent = document.body.classList.contains('dark-mode') ? '‚òÄÔ∏è Light' : 'üåô Dark';
        }
        
        if (localStorage.getItem('darkMode') === 'enabled') {
            document.body.classList.add('dark-mode');
            document.getElementById('dark-toggle').textContent = '‚òÄÔ∏è Light';
        }

        // Load dashboard stats
        async function loadStats() {
            try {
                const draftsRes = await fetch('/api/drafts/queue');
                const drafts = await draftsRes.json();
                document.getElementById('stat-drafts').textContent = drafts.length || 0;
                
                const active = drafts.filter(d => d.status === 'active').length;
                document.getElementById('stat-active').textContent = active;
            } catch (e) {
                console.error('Error loading stats:', e);
            }
        }

        async function loadActivity() {
            try {
                const res = await fetch('/api/drafts/queue?limit=5');
                const drafts = await res.json();
                const list = document.getElementById('activity-list');
                
                if (drafts.length === 0) {
                    list.innerHTML = '<p style="color: #6c757d;">No recent activity</p>';
                    return;
                }
                
                list.innerHTML = drafts.map(d => `
                    <div class="activity-item">
                        <strong>${d.title || 'Untitled'}</strong> - Created draft (${d.status})
                        <br><small style="color: #6c757d;">${new Date(d.created_at).toLocaleString()}</small>
                    </div>
                `).join('');
            } catch (e) {
                document.getElementById('activity-list').innerHTML = '<p style="color: #dc3545;">Error loading activity</p>';
            }
        }

        loadStats();
        loadActivity();
        
        // Load version
        fetch('/version')
            .then(r => r.json())
            .then(data => {
                const versionEl = document.getElementById('app-version');
                if (versionEl && data.version) {
                    versionEl.textContent = data.version;
                }
            })
            .catch(() => {
                const versionEl = document.getElementById('app-version');
                if (versionEl) versionEl.textContent = '1.0.0';
            });
        
        const darkTextElements = document.querySelectorAll('.dark-text');
        if (document.body.classList.contains('dark-mode')) {
            darkTextElements.forEach(el => el.style.color = '#e0e0e0');
        }
    </script>
</body>
</html>

